
<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <!--[if lte IE 8]>
      <script type="text/javascript">
        var tags = ['header', 'footer', 'nav', 'aside', 'article', 'section', 'object', 'main'];
        for (var i in tags) {
          document.createElement(tags[i]);
        }
      </script>
    <![endif]-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mocha</title>
    <!-- font -->
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" />
    <!-- js -->
    <script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
    <!-- css -->
    <link rel="stylesheet" href="/css/reset.css" />
    <link rel="stylesheet" href="/css/icon.css" />
    <link rel="stylesheet" href="/katex/katex.min.css" />
     
    <link rel="stylesheet" href="/css/index.css" />
     
  <meta name="generator" content="Hexo 5.4.1"></head>

  <body>
    <!-- header -->
    <header class="header">
  <div class="logo">
    <!-- logo -->
    <div class="logo-wrap">
      <a href="/" id="logo"></a>
    </div>
  </div>
  <nav class="nav" id="top-nav">
    <ul>
      
        <li>
          <a class="" href="/">主页</a>
        </li>
      
        <li>
          <a class="" href="/categories">分类</a>
        </li>
      
        <li>
          <a class="" href="/tags">标签</a>
        </li>
      
        <li>
          <a class="" href="/archives">归档</a>
        </li>
      
      <!-- search -->
      
    </ul>
  </nav>
</header>


  
    <!-- main -->
    <main id="main" class="main">
      <!-- post -->

<div class="post show-toc">
  <!-- table of content -->
  
    <div class="post-toc">
      <div class="post-toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%A5%97%E4%BB%B6%E4%B8%8E%E7%94%A8%E4%BE%8B"><span class="toc-text"> 测试套件与用例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#it"><span class="toc-text"> it</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#describe"><span class="toc-text"> describe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only"><span class="toc-text"> only</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#skip"><span class="toc-text"> skip</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81"><span class="toc-text"> 测试异步代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83"><span class="toc-text"> 回调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#promise"><span class="toc-text"> Promise</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%A9%E5%AD%90"><span class="toc-text"> 钩子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#root-level-hooks"><span class="toc-text"> Root-level Hooks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E9%92%A9%E5%AD%90"><span class="toc-text"> 异步钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-text"> 注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-text"> 动态生成测试用例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E6%97%B6"><span class="toc-text"> 超时</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wallabyjs"><span class="toc-text"> WALLABY.JS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text"> 参考</span></a></li></ol>
      </div>
    </div>
  
  <!-- table of content end-->
  <!-- article -->
  <div class="cell">
    <article class="article">
      <!-- title -->
      
          <h1  class="title">Mocha</h1> 
      
      <div class="post-meta">
        <!-- time -->
        
          <span class="icon-baseline-query_builder-24px"></span>
          <time datetime="2019-09-15T16:00:00.000Z">
            2019-09-16
          </time>
        
        <!-- categories -->
        <!--
          <span class="icon-baseline-work_outline-24px"></span>
          
            <a href="/categories/unit-testing/">
              <span>unit testing</span>
            </a>
          
        -->
        <!-- categories end -->
        <!-- tag -->
        <span class="icon-baseline-subtitles-24px"></span>
        
          <a href="/tags/unit-testing/">
            <span>unit testing</span>
          </a>
        
      </div>
      <!-- content -->
      <div class="article-content">
      <p>Mocha 是一个功能丰富的 JavaScript 串行测试框架.支持多种运行环境,可以在 Node.js 和 浏览器 中运行.<br />
通过 Mocha, 可以便捷的测试异步函数, 捕获错误, 生成测试报告.</p>
<p><a target="_blank" rel="noopener" href="https://mochajs.org/">官网文档</a></p>
<p>下面是针对 sum 函数创建的一个测试案例:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;sum 函数&#x27;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 测试套件</span></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;0.1 + 0.2 = 0.3&#x27;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 测试用例</span></span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>); <span class="comment">// 断言</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>运行结果:<br />
<img src="/img/ea1377f2.PNG" alt="1.PNG" /></p>
<p>另外, 上面代码中的断言(expect)来自于 <a target="_blank" rel="noopener" href="https://www.chaijs.com/">chai</a>, 而非 Mocha.  Mocha 没有内置断言库, 需要自己载入.</p>
<p><a target="_blank" rel="noopener" href="https://mochajs.org/#assertions">官方推荐的断言库</a></p>
<p>什么是断言?<br />
断言是一种逻辑判断, 如果判断的结果不为真,就中断程序,并抛出错误. 类似于:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;测试 sum 函数&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">1</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="测试套件与用例"><a class="markdownIt-Anchor" href="#测试套件与用例"></a> 测试套件与用例</h2>
<h3 id="it"><a class="markdownIt-Anchor" href="#it"></a> it</h3>
<p>创建 测试用例(test case).<br />
每个测试用例可以包含一个或多个断言.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;1 + 1 = 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">1</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/img/118e56ff.PNG" alt="1234.PNG" /></p>
<p>只要测试用例中的一个断言出错,该用例就不能通过测试.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;sum&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">1</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">2</span>, <span class="number">2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/img/4712ec54.PNG" alt="123456.PNG" /></p>
<p><strong>待测试</strong>:<br />
如果在调用 it 时没有传入第二个参数,Mocha 会跳过这个测试并显示在结果中用-号表示未执行,不会报错.<br />
没想好某个测试要怎么写或是将来需要某个测试时可以这样写.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 1&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 2&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/img/02f06dab.PNG" alt="123.PNG" /></p>
<p>注: 在 Mocha 中, specify 是 it 的别名, 二者作用相同.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 1&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  <span class="title function_">specify</span>(<span class="string">&#x27;specify 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/img/096b6baf.PNG" alt="456.PNG" /></p>
<h3 id="describe"><a class="markdownIt-Anchor" href="#describe"></a> describe</h3>
<p>创建测试套件(test suite), 单个 describe 中至少应该包含一个或多个 测试用例(it).  测试套件间可以相互嵌套.</p>
<p>例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被测函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Num</span> = value =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">_value</span>: value,</span><br><span class="line">    <span class="title function_">add</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_value</span> += value;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试套件</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;测试 Num 方法&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> n = <span class="title class_">Num</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 测试套件间可以相互嵌套  </span></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;foo._value&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;foo._value等于1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(n.<span class="property">_value</span>).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;foo.add&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;foo.add(2)返回3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(n.<span class="title function_">add</span>(<span class="number">2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/0eb9ab45.PNG" alt="捕获.PNG" /></p>
<p>什么是测试套件?<br />
测试套件 是多个 测试用例(test case) 的集合.<br />
在编写测试代码时,可以用测试套件对测试用例整理分类, 将不同的测试用例归类到一起.<br />
例如在测试一个加法函数时,可能会分别测试整数和小数,这时可以分别划分出两个子测试套件.</p>
<p>例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">...arg</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> i !== <span class="string">&#x27;number&#x27;</span> || <span class="built_in">isNaN</span>(i)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;传入的参数必须是数值&#x27;</span>)  </span><br><span class="line">    &#125;</span><br><span class="line">    num += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;sum 函数&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;整数测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;1 + 1 = 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">1</span>)).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;1 + 2 + 3 = 6&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">6</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;小数测试&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;0.1 + 0.2 = 0.3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/7d50032b.PNG" alt="11.PNG" /></p>
<p>注: 在 Mocha 中, context 是 describe 的别名, 二者作用相同.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">context</span>(<span class="string">&#x27;context&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 2&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/img/4fe65773.PNG" alt="123.PNG" /></p>
<h3 id="only"><a class="markdownIt-Anchor" href="#only"></a> only</h3>
<p>仅执行某些测试套件/用例</p>
<p>如果有很多测试套件/用例,但只想执行其中的几个.这时就可以通过在 describe 和 it 后添加 only 关键字的方式, 来选择需要执行的测试套件/用例.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;测试1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;1 + 1 = 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe.<span class="title function_">only</span>(<span class="string">&#x27;测试2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;0.1 + 0.2 = 0.3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    it.<span class="title function_">only</span>(<span class="string">&#x27;0.2 + 0.2 = 0.4&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.2</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.4</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以注意到只有最后一个测试(0.2 + 0.2 = 0.4) 被执行, 之前的两个被忽略掉了.<br />
<img src="/img/f6eb104c.PNG" alt="qwrqr.PNG" /></p>
<h3 id="skip"><a class="markdownIt-Anchor" href="#skip"></a> skip</h3>
<p>不执行测试套件/用例</p>
<p>作用和 only 正好相反, 通过在 describe 和 it 后追加 skip 关键字, 来跳过某个测试套件/用例.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> num = a + b;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseFloat</span>(num.<span class="title function_">toPrecision</span>(<span class="number">15</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe.<span class="title function_">skip</span>(<span class="string">&#x27;测试1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;1 + 1 = 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;测试2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    it.<span class="title function_">skip</span>(<span class="string">&#x27;0.1 + 0.2 = 0.3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.1</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.3</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;0.2 + 0.2 = 0.4&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">0.2</span>, <span class="number">0.2</span>)).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">0.4</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/8f369c33.PNG" alt="rqdas.PNG" /></p>
<h2 id="测试异步代码"><a class="markdownIt-Anchor" href="#测试异步代码"></a> 测试异步代码</h2>
<h3 id="回调"><a class="markdownIt-Anchor" href="#回调"></a> 回调</h3>
<p>it的回调函数接受 done 参数, 可以通过调用 done() 来表示测试成功, 或传入一个错误 done(Error), 表示运行失败.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;lazybones 1&#x27;</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;lazybones 2&#x27;</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">done</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>());</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/d9a16381.PNG" alt="qeqeqe.PNG" /></p>
<p>即使没有调用 done , 也会因为超时而执行.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;lazybones 1&#x27;</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;&#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/3da25da8.PNG" alt="1.PNG" /></p>
<p>有一点需要注意的是.只有在接受了 done 作为参数,才会因为没有调用 done 而超时报错.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;done =&gt; &#123;&#125;&#x27;</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;() =&gt; &#123;&#125;&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/a02dfe21.PNG" alt="2.PNG" /></p>
<h3 id="promise"><a class="markdownIt-Anchor" href="#promise"></a> Promise</h3>
<p>对于Promise, 可以直接将其返回. 通过在 Promise.then 中执行断言来判断是否执行成功.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;return Promise&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">10</span>);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(num).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意: 不要在传入 done作为回调参数 的同时 返回 promise,这会导致错误(不同版本可 Mocha 可能有改动):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure &quot;done()&quot; is called; if returning a Promise, ensure it resolves.</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;it&#x27;</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="钩子"><a class="markdownIt-Anchor" href="#钩子"></a> 钩子</h2>
<p>Mocha 提供了 before after beforeEach afterEach 四个钩子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;hooks&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在(当前测试套件所属的)所有的测试用前运行</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">after</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在(当前测试套件所属的)所有的测试用例后运行</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在(当前测试套件所属的)每个测试用例执行前运行</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在(当前测试套件所属的)每个测试用例执行后运行</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>beforeEach 和 afterEach 会在每一个测试用例和测试套件之前执行,对于嵌套的 describe 也是如此.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;hook&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">after</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeEach&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;afterEach&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;it 1&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;it 2&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;describe 2&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;it 3&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;4&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;it 4&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/4b538c6a.PNG" alt="123.PNG" /></p>
<h3 id="root-level-hooks"><a class="markdownIt-Anchor" href="#root-level-hooks"></a> Root-level Hooks</h3>
<p>钩子并不一定要放在 describe 里, 也可以直接放在最外层.例如:<br />
(实际上最外层的测试套件(describe) 也被包含在一个隐藏的 根套件 (root suite) 中).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">after</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it&#x27;</span>, <span class="function">() =&gt;</span>&#123;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/cdc898f2.PNG" alt="456.PNG" /></p>
<h3 id="异步钩子"><a class="markdownIt-Anchor" href="#异步钩子"></a> 异步钩子</h3>
<p>与异步的测试用例一样, 可以通过 调用 done 或 回传 Promise 来执行异步钩子.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo;</span><br><span class="line"><span class="title function_">before</span>(<span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    foo = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;foo的值应该为bar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo;</span><br><span class="line"><span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      foo = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;foo的值应该为bar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(foo).<span class="property">to</span>.<span class="title function_">equal</span>(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="注释"><a class="markdownIt-Anchor" href="#注释"></a> 注释</h3>
<p>与 describe 一样,钩子也可以传入字符串作为第一个参数.便于在出错的时候定位错误:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">before</span>(<span class="string">&#x27;before 1&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;describe&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/f25d990c.PNG" alt="123.PNG" /></p>
<p>作为对比,不添加注释时的表现如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">before(() =&gt; &#123;</span><br><span class="line">  throw new TypeError();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(&#x27;describe&#x27;, () =&gt; &#123;</span><br><span class="line">  it(&#x27;it&#x27;, () =&gt; &#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/69d5f5f2.PNG" alt="456.PNG" /></p>
<p>注意: 如果测试套件(describe)中没有测试用例(it), 则测试套件中的钩子不会被执行.</p>
<h2 id="动态生成测试用例"><a class="markdownIt-Anchor" href="#动态生成测试用例"></a> 动态生成测试用例</h2>
<p>如果需要测试的数据非常多,则可以通过动态生成测试用例来测试代码.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;sum&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> tests = [</span><br><span class="line">    &#123; <span class="attr">args</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="attr">expected</span>: <span class="number">3</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">args</span>: [-<span class="number">1</span>, -<span class="number">2</span>], <span class="attr">expected</span>: -<span class="number">3</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">args</span>: [<span class="number">0.1</span>, <span class="number">0.2</span>], <span class="attr">expected</span>: <span class="number">0.3</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">args</span>: [-<span class="number">0.1</span>, -<span class="number">0.2</span>], <span class="attr">expected</span>: -<span class="number">0.3</span> &#125;</span><br><span class="line">  ];</span><br><span class="line">  tests.<span class="title function_">forEach</span>(<span class="function"><span class="params">test</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> args = test.<span class="property">args</span>;</span><br><span class="line">    <span class="title function_">it</span>(args.<span class="title function_">join</span>(<span class="string">&#x27; + &#x27;</span>), <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">sum</span>(...args)).<span class="property">to</span>.<span class="title function_">equal</span>(test.<span class="property">expected</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/ee4beeb4.PNG" alt="1234.PNG" /></p>
<h2 id="超时"><a class="markdownIt-Anchor" href="#超时"></a> 超时</h2>
<p>如果代码的执行时间较长, 可以通过 this.timeout(<millisecond>) 设置超时时间.</p>
<p>没有超时:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;it&#x27;</span>, <span class="keyword">function</span>(<span class="params">done</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">20</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(done, <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/790f3590.PNG" alt="456.PNG" /></p>
<p>超时了:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;it&#x27;</span>, <span class="keyword">function</span>(<span class="params">done</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(done, <span class="number">20</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/img/94acc179.PNG" alt="123.PNG" /></p>
<p>可以在任意位置调用 this.timeout , 其设置会被嵌套的套件/实例所继承.<br />
如需禁用超时检测, 可以设置 this.timeout(0).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">before</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">50</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;des&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 关闭超时时间, 会被所有内部的 describe/ it 和钩子 继承;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 1&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">timeout</span>(<span class="number">50</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;it 2&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意:<br />
箭头函数没有 this, 如果需要更改超时时间, 请使用普通函数.<br />
(Mocha 官方不建议使用箭头函数)</p>
<p><strong>总超时时间</strong>:　<br />
可以在运行 Mocha 时调用 --timeout 或 -t 来设置总超时时间.  <a target="_blank" rel="noopener" href="https://mochajs.org/#command-line-usage">Mocha - the fun, simple, flexible JavaScript test framework</a></p>
<p>如果是通过 Karma 调用 Mocha,则需到 karma 的配置文件中配置.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// karma.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> <span class="title function_">karmaConfig</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  config.<span class="title function_">set</span>(&#123;</span><br><span class="line">    <span class="attr">frameworks</span>: [<span class="string">&#x27;mocha&#x27;</span>, <span class="string">&#x27;sinon-chai&#x27;</span>],</span><br><span class="line">    <span class="attr">client</span>: &#123;</span><br><span class="line">      <span class="attr">mocha</span>: &#123;</span><br><span class="line">        <span class="attr">timeout</span>: <span class="number">10</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="wallabyjs"><a class="markdownIt-Anchor" href="#wallabyjs"></a> WALLABY.JS</h2>
<p>todo</p>
<h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html">测试框架 Mocha 实例教程 - 阮一峰的网络日志</a><br />
<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19298118/what-is-the-role-of-describe-in-mocha">node.js - What is the role of describe() in Mocha? - Stack Overflow</a><br />
<a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1022910821149312/1101741181366880">mocha - 廖雪峰的官方网站</a></p>

      </div>
    </article>
  </div>
  <!-- pagination -->
  
    <nav class="pagination">
      
        <a class="prev" href="/article/%E5%B8%B8%E7%94%A8%E7%9A%84%20LaTeX%20%E7%AC%A6%E5%8F%B7%E5%85%AC%E5%BC%8F/">&lt;  常用的 LaTeX 符号公式</a>
      
      
        <a class="next" href="/article/HTTP%20%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81/">HTTP 响应状态码  &gt;</a>
      
    </nav>    
  
  <!-- pagination end -->
</div>






    </main>

    <!-- search -->
     
    
    <script src="/js/main.js"></script>
     
  </body>
</html>
