
<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <!--[if lte IE 8]>
      <script type="text/javascript">
        var tags = ['header', 'footer', 'nav', 'aside', 'article', 'section', 'object', 'main'];
        for (var i in tags) {
          document.createElement(tags[i]);
        }
      </script>
    <![endif]-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>利用Three.js实现粒子系统</title>
    <!-- font -->
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" />
    <!-- js -->
    <script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
    <!-- css -->
    <link rel="stylesheet" href="/css/reset.css" />
    <link rel="stylesheet" href="/css/icon.css" />
    <link rel="stylesheet" href="/katex/katex.min.css" />
     
    <link rel="stylesheet" href="/css/index.css" />
     
  <meta name="generator" content="Hexo 5.4.1"></head>

  <body>
    <!-- header -->
    <header class="header">
  <div class="logo">
    <!-- logo -->
    <div class="logo-wrap">
      <a href="/" id="logo"></a>
    </div>
  </div>
  <nav class="nav" id="top-nav">
    <ul>
      
        <li>
          <a class="" href="/">主页</a>
        </li>
      
        <li>
          <a class="" href="/categories">分类</a>
        </li>
      
        <li>
          <a class="" href="/tags">标签</a>
        </li>
      
        <li>
          <a class="" href="/archives">归档</a>
        </li>
      
      <!-- search -->
      
    </ul>
  </nav>
</header>


  
    <!-- main -->
    <main id="main" class="main">
      <!-- post -->

<div class="post show-toc">
  <!-- table of content -->
  
    <div class="post-toc">
      <div class="post-toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text"> 参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#points"><span class="toc-text"> Points</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-text"> 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#geometry"><span class="toc-text"> geometry</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ispoints"><span class="toc-text"> isPoints</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#material"><span class="toc-text"> material</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-text"> 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#raycast"><span class="toc-text"> raycast ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#clone"><span class="toc-text"> clone</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pointsmaterial-parameters"><span class="toc-text"> PointsMaterial( parameters )</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-2"><span class="toc-text"> 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#color"><span class="toc-text"> color</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ispointsmaterial"><span class="toc-text"> isPointsMaterial</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lights"><span class="toc-text"> lights</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-text"> map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-text"> size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sizeattenuation"><span class="toc-text"> sizeAttenuation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A23d%E6%A8%A1%E5%9E%8B%E4%B8%BA%E7%B2%92%E5%AD%90%E6%95%88%E6%9E%9C"><span class="toc-text"> 转换3D模型为粒子效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shadermaterial"><span class="toc-text"> ShaderMaterial</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-text"> 例子</span></a></li></ol>
      </div>
    </div>
  
  <!-- table of content end-->
  <!-- article -->
  <div class="cell">
    <article class="article">
      <!-- title -->
      
          <h1  class="title">利用Three.js实现粒子系统</h1> 
      
      <div class="post-meta">
        <!-- time -->
        
          <span class="icon-baseline-query_builder-24px"></span>
          <time datetime="2017-12-31T06:20:00.000Z">
            2017-12-31
          </time>
        
        <!-- categories -->
        <!--
          <span class="icon-baseline-work_outline-24px"></span>
          
            <a href="/categories/JavaScript-library/">
              <span>JavaScript library</span>
            </a>
          
        -->
        <!-- categories end -->
        <!-- tag -->
        <span class="icon-baseline-subtitles-24px"></span>
        
          <a href="/tags/JavaScript/">
            <span>JavaScript</span>
          </a>
        
          <a href="/tags/JavaScript-library/">
            <span>JavaScript library</span>
          </a>
        
          <a href="/tags/three-js/">
            <span>three.js</span>
          </a>
        
          <a href="/tags/WebGL/">
            <span>WebGL</span>
          </a>
        
          <a href="/tags/HTML5/">
            <span>HTML5</span>
          </a>
        
          <a href="/tags/Canvas/">
            <span>Canvas</span>
          </a>
        
      </div>
      <!-- content -->
      <div class="article-content">
      <h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/wanbo/p/6869175.html">three.js粒子效果（分别基于CPU&amp;GPU实现）</a><br />
<a target="_blank" rel="noopener" href="http://www.htmleaf.com/jQuery/Layout-Interface/201501271284.html">tween.js</a><br />
<a target="_blank" rel="noopener" href="http://www.cnblogs.com/yiyezhai/archive/2013/01/23/2866176.htmlTHREE.JS%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B-4.%E5%88%9B%E5%BB%BA%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F">THREE.JS入门教程-4.创建粒子系统</a><br />
<a target="_blank" rel="noopener" href="http://zhangwenli.com/blog/2017/02/24/what-is-a-shader/">致从没看懂过着色器代码的你</a></p>
<h2 id="points"><a class="markdownIt-Anchor" href="#points"></a> Points</h2>
<p>Points( geometry, material )<br />
用来创建点的构造函数,由WebGLRenderer渲染</p>
<h3 id="属性"><a class="markdownIt-Anchor" href="#属性"></a> 属性</h3>
<h4 id="geometry"><a class="markdownIt-Anchor" href="#geometry"></a> geometry</h4>
<p>Geometry|BufferGeometry的实例,用于定义结构<br />
建议使用BufferGeometry(性能好)</p>
<h4 id="ispoints"><a class="markdownIt-Anchor" href="#ispoints"></a> isPoints</h4>
<p>检查对象是否是由Points构造函数生成的</p>
<h4 id="material"><a class="markdownIt-Anchor" href="#material"></a> material</h4>
<p>一个Material实例,用于设置材质<br />
默认值为PointsMaterial(随机颜色)</p>
<h3 id="方法"><a class="markdownIt-Anchor" href="#方法"></a> 方法</h3>
<p>公共方法见基类Object3D</p>
<h4 id="raycast"><a class="markdownIt-Anchor" href="#raycast"></a> raycast ?</h4>
<p>raycast ( raycaster, intersects )</p>
<h4 id="clone"><a class="markdownIt-Anchor" href="#clone"></a> clone</h4>
<p>clone()<br />
复制Points对象</p>
<h2 id="pointsmaterial-parameters"><a class="markdownIt-Anchor" href="#pointsmaterial-parameters"></a> PointsMaterial( parameters )</h2>
<h3 id="属性-2"><a class="markdownIt-Anchor" href="#属性-2"></a> 属性</h3>
<h4 id="color"><a class="markdownIt-Anchor" href="#color"></a> color</h4>
<p>材料颜色,默认值为0xffffff</p>
<h4 id="ispointsmaterial"><a class="markdownIt-Anchor" href="#ispointsmaterial"></a> isPointsMaterial</h4>
<p>检测对象是否是PointsMaterial的实例,布尔值</p>
<h4 id="lights"><a class="markdownIt-Anchor" href="#lights"></a> lights</h4>
<p>是否受灯光影响.默认值为false</p>
<h4 id="map"><a class="markdownIt-Anchor" href="#map"></a> map</h4>
<p>设置贴图材质</p>
<h4 id="size"><a class="markdownIt-Anchor" href="#size"></a> size</h4>
<p>设置点的大小尺寸,默认值为1</p>
<h4 id="sizeattenuation"><a class="markdownIt-Anchor" href="#sizeattenuation"></a> sizeAttenuation</h4>
<p>点的大小是否受距离影响(越远越小),默认值为true</p>
<p>其他公共属性见基类Material</p>
<p><img src="/img/pointsMaterial.PNG" alt="" /></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sphereShape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">100</span>, <span class="number">32</span>, <span class="number">16</span>);</span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0x000000</span>,</span><br><span class="line">    <span class="comment">// 更改粒子大小</span></span><br><span class="line">    <span class="attr">size</span>: <span class="number">2</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> sphereShapParticleMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(sphereShape, material);</span><br><span class="line">scene.<span class="title function_">add</span>(sphereShapParticleMesh);</span><br></pre></td></tr></table></figure>
<p>也可以加载图片作为粒子<br />
<img src="/img/MeshNormalMaterial2.PNG" alt="" /></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sphereShape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">100</span>, <span class="number">32</span>, <span class="number">16</span>);</span><br><span class="line"><span class="keyword">var</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;img/point.png&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0x000000</span>,</span><br><span class="line">    <span class="attr">size</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">map</span>: texture,</span><br><span class="line">    <span class="comment">// 带透明背景的图片需开启transparent</span></span><br><span class="line">    <span class="attr">transparent</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// depthTest需看情况而定,图片出现白边/黑边时设置为false</span></span><br><span class="line">    <span class="attr">depthTest</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> sphereShapParticleMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(sphereShape, material);</span><br><span class="line">scene.<span class="title function_">add</span>(sphereShapParticleMesh);</span><br></pre></td></tr></table></figure>
<h2 id="转换3d模型为粒子效果"><a class="markdownIt-Anchor" href="#转换3d模型为粒子效果"></a> 转换3D模型为粒子效果</h2>
<p>json格式模型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入材质</span></span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0xffff00</span>,</span><br><span class="line">    <span class="attr">size</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">map</span>: <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(<span class="string">&#x27;img/dot.png&#x27;</span>),</span><br><span class="line">    <span class="attr">transparent</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">depthTest</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> points;</span><br><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">JSON</span>Loader();</span><br><span class="line">loader.<span class="title function_">load</span>(<span class="string">&#x27;model.json&#x27;</span>,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params"> geometry, materials </span>) &#123;</span><br><span class="line">        points = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(geometry, material);</span><br><span class="line">        points.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>);</span><br><span class="line">        scene.<span class="title function_">add</span>(points);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>注 json模型的顶点储存在geometry.vertices中</p>
<p>obj格式模型<br />
<img src="/img/pointstree.PNG" alt="" /></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tree = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line"><span class="keyword">var</span> objLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OBJLoader</span>();</span><br><span class="line">objLoader.<span class="title function_">load</span>(<span class="string">&#x27;model.obj&#x27;</span>, <span class="keyword">function</span>(<span class="params">object</span>) &#123;</span><br><span class="line">    tree = object;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; object.<span class="property">children</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> points =<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(object.<span class="property">children</span>[i].<span class="property">geometry</span>, material);</span><br><span class="line">        points.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">200</span>,<span class="number">200</span>,<span class="number">200</span>);</span><br><span class="line">        tree.<span class="title function_">add</span>(points);</span><br><span class="line">    &#125;</span><br><span class="line">    scene.<span class="title function_">add</span>(tree);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注 obj模型的顶点储存在object.children[i].geometry.attributes.position.array中</p>
<h2 id="shadermaterial"><a class="markdownIt-Anchor" href="#shadermaterial"></a> ShaderMaterial</h2>
<p>使用自定义着色器渲染材质.着色器是运行在GPU上的一小段程序,使用GLSL编写.</p>
<ul>
<li>implement an effect not included with any of the built-in materials ?</li>
<li>使用Geometry或BufferGeometry将多个图形绑在一起,已提高性能.<br />
注意事项</li>
<li>GLSL 代码只能在GPU中运行,因此ShaderMaterial只能用WebGLRenderer渲染</li>
<li>从THREE R72开始,不支持直接在ShaderMaterial中分配属性.使用BufferGeometry(代替Geometry),用BufferAttribute定义attributes</li>
<li>从THREE R77开始, uniforms选项不再支持WebGLRenderTarget|WebGLRenderTargetCube实例</li>
<li>Built in attributes和uniforms通过你的代码传递给着色器,如果不希望WebGLProgram向着色器添加任何内容,可以使用RawShaderMaterial代替ShaderMaterial</li>
</ul>
<h2 id="例子"><a class="markdownIt-Anchor" href="#例子"></a> 例子</h2>
<p><a href="/test/three/changeShap/">形状变化</a></p>

      </div>
    </article>
  </div>
  <!-- pagination -->
  
    <nav class="pagination">
      
        <a class="prev" href="/article/Three.js%E6%A8%A1%E5%9E%8B%E8%BD%BD%E5%85%A5/">&lt;  Three.js 模型载入</a>
      
      
        <a class="next" href="/article/three.js%E5%85%A5%E9%97%A8/">Three.js入门  &gt;</a>
      
    </nav>    
  
  <!-- pagination end -->
</div>






    </main>

    <!-- search -->
     
    
    <script src="/js/main.js"></script>
     
  </body>
</html>
